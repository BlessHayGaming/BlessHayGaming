{"hash":"047dc01c7d0411743559355d433665c037917a49","data":{"learnPost":{"id":"35e20b005b83dcb688bf2606041246cb","title":"Play Spine Animation Tracks Exactly Once in GMS2","content":"<h2 id=\"the-problem\"><a href=\"#the-problem\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>The Problem</h2>\n<p>While GameMaker:Studio does have an <em>Animation end</em> event, this event only reacts on the main <em>animation track</em> (track 0), and not on all the other tracks. However, using the at-the-time-of-writing new <em>Animation event</em> event, you can now easily make sure that specific animations on any track only play once.</p>\n<p><img src=\"http://i.imgur.com/bWHVWCw.png\" alt=\"Animation Event\"></p>\n<h2 id=\"what-to-do-in-spine\"><a href=\"#what-to-do-in-spine\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>What to Do in Spine</h2>\n<p>The first thing you need to do, is setting up a \"stop\" event in your animation. You do this in Spine, as I showcase in the video below.</p>\n<iframe width=\"560\" height=\"315\" src=\"https://www.youtube.com/embed/wg3QwMECoec?rel=0&amp;showinfo=0\" frameborder=\"0\" allowfullscreen></iframe>\nAs the video explains:\n<ul>\n<li>You first add the event to your hierarchy.</li>\n<li>You then key the event at the last frame of the animations you want to stop after playing once (or wherever you want the animation to stop).</li>\n</ul>\n<p>These animations will typically be secondary animations, and rarely the animations you place on track 0, as you can simply use the <em>Animation end</em> event for these, as explained before.</p>\n<p>After this you of course export your character and loads it into GameMaker:Studio as a skeletal sprite.</p>\n<h2 id=\"what-to-do-in-gamemakerstudio\"><a href=\"#what-to-do-in-gamemakerstudio\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>What to Do in GameMaker:Studio</h2>\n<p><em>As there has not yet been written a manual entry on the subject of the Animation event event at the time of writing, you will have to use <a href=\"https://forum.yoyogames.com/index.php?threads/errors-with-spine.12934/#post-99143\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Nocturne's forum post on the topic</a> for reference. Nocturne flesh out multiple other Spine-related updates in this post.</em></p>\n<p>When the sprite is added and attached to an object, we now add the <em>Animation event</em> event to the object as well. You find the event under the <em>Other</em> category. You then add a code block to the event.</p>\n<p>The event is triggered by Spine events and automatically generates a <em>ds_map</em>. This <em>ds_map</em> is accessed through the variable <code>event_data</code> local to the event. The <em>ds_map</em> contains multiple keys, but for our purpose we only need two: The \"name\" key, to check if the current event is the \"stop\" event, and the \"track\" key, to check which <em>animation track</em> the animation is running on.</p>\n<p>Let's begin writing the code. First we test for the correct event:</p>\n<pre><code>if event_data[? \"name\"] == \"stop\" {\n}\n</code></pre>\n<p>Note that I use the <em><a href=\"https://docs.yoyogames.com/source/dadiospice/002_reference/001_gml%20language%20overview/accessors.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">accessor</a></em> \"?\" to easily look inside the <em>ds_map</em>. After that we simply turn off the animation track in question by using <a href=\"https://docs.yoyogames.com/source/dadiospice/002_reference/game%20assets/sprites/skeletal%20animations/skeleton_animation_clear.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><code>skeleton_animation_clear();</code></a>:</p>\n<pre><code>if event_data[? \"name\"] == \"stop\" {\n skeleton_animation_clear(event_data[? \"track\"];\n}\n</code></pre>\n<h2 id=\"and-voilá\"><a href=\"#and-voil%C3%A1\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>..and Voilá!</h2>\n<p>Now your animation will stop after playing exactly once! Yes, it is really that easy. Hope you enjoyed!</p>\n<p>Regards,\nSimon</p>\n"}},"context":{}}